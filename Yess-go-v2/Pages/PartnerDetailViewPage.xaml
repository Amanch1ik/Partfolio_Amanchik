<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:converters="clr-namespace:YessGoFront.Converters"
             x:Class="YessGoFront.Pages.PartnerDetailViewPage"
             BackgroundColor="#F9F9F9"
             Title="ÐŸÑ€Ð¾Ð´ÑƒÐºÑ‚Ñ‹ Ð¿Ð°Ñ€Ñ‚Ð½Ñ‘Ñ€Ð°">

    <ContentPage.Resources>
        <ResourceDictionary>
            <converters:StringToImageSourceConverter x:Key="StringToImageSourceConverter" />
            <converters:IsNotNullConverter x:Key="IsNotNullConverter" />
        </ResourceDictionary>
    </ContentPage.Resources>

    <ScrollView>
        <VerticalStackLayout Spacing="0">
            <!-- ÐžÐ±Ð»Ð¾Ð¶ÐºÐ° Ñ Ð¸Ð·Ð¾Ð±Ñ€Ð°Ð¶ÐµÐ½Ð¸ÐµÐ¼ Ð¿Ð°Ñ€Ñ‚Ð½Ñ‘Ñ€Ð° -->
            <Grid HeightRequest="250" BackgroundColor="#DC2626">
                <Image x:Name="CoverImage"
                       Aspect="AspectFill"
                       Opacity="0.5"
                       HorizontalOptions="Fill"
                       VerticalOptions="Fill"/>

                <!-- Ð’ÐµÑ€Ñ…Ð½ÑÑ Ð¿Ð°Ð½ÐµÐ»ÑŒ Ñ ÐºÐ½Ð¾Ð¿ÐºÐ¾Ð¹ Ð½Ð°Ð·Ð°Ð´, Ð¿Ð¾Ð¸ÑÐºÐ¾Ð¼ Ð¸ Ð¼ÐµÐ½ÑŽ -->
                <Grid Padding="16,12" RowDefinitions="Auto">
                    <HorizontalStackLayout Spacing="12" VerticalOptions="Start">
                        <Button x:Name="BackButton"
                                Text="â†"
                                BackgroundColor="#40000000"
                                TextColor="White"
                                FontSize="20"
                                FontAttributes="Bold"
                                WidthRequest="40"
                                HeightRequest="40"
                                CornerRadius="20"
                                Padding="0"
                                Clicked="OnBackClicked"/>
                        
                        <HorizontalStackLayout HorizontalOptions="EndAndExpand" Spacing="12">
                            <Label Text="ðŸ”"
                                   FontSize="20"
                                   TextColor="White"
                                   VerticalOptions="Center"
                                   Padding="8"
                                   BackgroundColor="Transparent"/>
                            <Label Text="â‹®"
                                   FontSize="24"
                                   TextColor="White"
                                   VerticalOptions="Center"
                                   Padding="8"
                                   BackgroundColor="Transparent"/>
                        </HorizontalStackLayout>
                    </HorizontalStackLayout>
                </Grid>
            </Grid>

            <!-- ÐžÑÐ½Ð¾Ð²Ð½Ð¾Ð¹ ÐºÐ¾Ð½Ñ‚ÐµÐ½Ñ‚ -->
            <VerticalStackLayout Spacing="16" Padding="20" BackgroundColor="#F9F9F9">
                <!-- Ð›Ð¾Ð³Ð¾Ñ‚Ð¸Ð¿ Ð¸ Ð½Ð°Ð·Ð²Ð°Ð½Ð¸Ðµ -->
                <HorizontalStackLayout Spacing="16" VerticalOptions="Start">
                    <!-- Ð›Ð¾Ð³Ð¾Ñ‚Ð¸Ð¿ Ð² ÐºÑ€Ð°ÑÐ½Ð¾Ð¼ ÐºÐ²Ð°Ð´Ñ€Ð°Ñ‚Ðµ -->
                    <Frame x:Name="LogoFrame"
                           WidthRequest="80"
                           HeightRequest="80"
                           CornerRadius="8"
                           HasShadow="True"
                           BackgroundColor="#DC2626"
                           Padding="8"
                           HorizontalOptions="Start">
                        <Label x:Name="LogoText"
                               Text="why cook"
                               TextColor="White"
                               FontSize="12"
                               FontAttributes="Bold"
                               HorizontalTextAlignment="Center"
                               VerticalTextAlignment="Center"
                               HorizontalOptions="Fill"
                               VerticalOptions="Fill"/>
                    </Frame>

                    <!-- ÐÐ°Ð·Ð²Ð°Ð½Ð¸Ðµ Ð±Ñ€ÐµÐ½Ð´Ð° -->
                    <VerticalStackLayout Spacing="4" VerticalOptions="Center">
                        <Label x:Name="PartnerNameLabel"
                               FontSize="28"
                               FontAttributes="Bold"
                               TextColor="Black"
                               HorizontalOptions="Start"/>
                    </VerticalStackLayout>
                </HorizontalStackLayout>

                <!-- ÐŸÑ€Ð¾Ð¼Ð¾ Ð¸ Ñ€ÐµÐ¹Ñ‚Ð¸Ð½Ð³ -->
                <HorizontalStackLayout Spacing="16" VerticalOptions="Center">
                    <!-- ÐŸÑ€Ð¾Ð¼Ð¾-Ð±ÐµÐ¹Ð´Ð¶ -->
                    <Border x:Name="PromoBorder"
                            BackgroundColor="#10B981"
                            StrokeThickness="0"
                            StrokeShape="RoundRectangle 8"
                            Padding="12,6">
                        <HorizontalStackLayout Spacing="6">
                            <Label x:Name="PromoPercentLabel"
                                   Text="-30%"
                                   FontSize="14"
                                   FontAttributes="Bold"
                                   TextColor="White"/>
                            <Label x:Name="PromoText"
                                   Text="ÑÐºÐ¸Ð´ÐºÐ¸ Ð½Ð° Ð²ÑÐµ"
                                   FontSize="12"
                                   TextColor="White"/>
                        </HorizontalStackLayout>
                    </Border>

                    <!-- Ð ÐµÐ¹Ñ‚Ð¸Ð½Ð³ -->
                    <HorizontalStackLayout Spacing="6" VerticalOptions="Center">
                        <Label Text="ðŸ‘"
                               FontSize="16"
                               VerticalOptions="Center"/>
                        <Label x:Name="RatingLabel"
                               Text="100% (500+)"
                               FontSize="14"
                               TextColor="#666"
                               VerticalOptions="Center"/>
                    </HorizontalStackLayout>
                </HorizontalStackLayout>

                <!-- Ð¡Ð¿Ð¸ÑÐ¾Ðº Ð¿Ñ€Ð¾Ð´ÑƒÐºÑ‚Ð¾Ð² -->
                <Label Text="ÐŸÑ€Ð¾Ð´ÑƒÐºÑ‚Ñ‹"
                       FontSize="20"
                       FontAttributes="Bold"
                       TextColor="Black"
                       Margin="0,8,0,8"/>

                <CollectionView x:Name="ProductsCollection"
                                SelectionMode="None"
                                ItemsLayout="VerticalList"
                                ItemSizingStrategy="MeasureFirstItem">
                    <CollectionView.ItemTemplate>
                        <DataTemplate>
                            <Frame BackgroundColor="White"
                                   BorderColor="Transparent"
                                   CornerRadius="12"
                                   Padding="0"
                                   Margin="0,0,0,16"
                                   HasShadow="True">
                                <Grid RowDefinitions="Auto,Auto,Auto,Auto" ColumnDefinitions="*,Auto">
                                    <!-- Ð˜Ð·Ð¾Ð±Ñ€Ð°Ð¶ÐµÐ½Ð¸Ðµ Ð¿Ñ€Ð¾Ð´ÑƒÐºÑ‚Ð° -->
                                    <Grid Grid.Row="0" Grid.ColumnSpan="2">
                                        <Image Source="{Binding ImageUrl, Converter={StaticResource StringToImageSourceConverter}}"
                                               Aspect="AspectFill"
                                               HeightRequest="180"
                                               HorizontalOptions="Fill"/>
                                        
                                        <!-- Ð‘ÐµÐ¹Ð´Ð¶ ÑÐºÐ¸Ð´ÐºÐ¸ -->
                                        <AbsoluteLayout>
                                            <Border AbsoluteLayout.LayoutBounds="12,12,60,24"
                                                    AbsoluteLayout.LayoutFlags="None"
                                                    BackgroundColor="#10B981"
                                                    StrokeThickness="0"
                                                    StrokeShape="RoundRectangle 8"
                                                    Padding="8,4"
                                                    IsVisible="{Binding DiscountPercent, Converter={StaticResource IsNotNullConverter}}">
                                                <Label Text="{Binding DiscountPercent, StringFormat='-{0}%'}"
                                                       FontSize="12"
                                                       FontAttributes="Bold"
                                                       TextColor="White"/>
                                            </Border>
                                        </AbsoluteLayout>
                                    </Grid>

                                    <!-- ÐÐ°Ð·Ð²Ð°Ð½Ð¸Ðµ Ð¿Ñ€Ð¾Ð´ÑƒÐºÑ‚Ð° -->
                                    <Label Grid.Row="1"
                                           Text="{Binding Name}"
                                           FontSize="18"
                                           FontAttributes="Bold"
                                           TextColor="Black"
                                           Margin="16,12,16,4"
                                           LineBreakMode="WordWrap"/>

                                    <!-- ÐžÐ¿Ð¸ÑÐ°Ð½Ð¸Ðµ/Ð¸Ð½Ð³Ñ€ÐµÐ´Ð¸ÐµÐ½Ñ‚Ñ‹ -->
                                    <Label Grid.Row="2"
                                           Text="{Binding Ingredients}"
                                           FontSize="14"
                                           TextColor="#666"
                                           Margin="16,0,16,12"
                                           LineBreakMode="WordWrap"
                                           IsVisible="{Binding Ingredients, Converter={StaticResource IsNotNullConverter}}"/>

                                    <!-- Ð¦ÐµÐ½Ð° Ð¸ ÐºÐ½Ð¾Ð¿ÐºÐ° -->
                                    <Grid Grid.Row="3"
                                          Grid.ColumnSpan="2"
                                          ColumnDefinitions="*,Auto"
                                          Margin="16,0,16,16">
                                        <VerticalStackLayout Grid.Column="0" Spacing="4">
                                            <!-- Ð¡Ñ‚Ð°Ñ€Ð°Ñ Ñ†ÐµÐ½Ð° (Ð·Ð°Ñ‡ÐµÑ€ÐºÐ½ÑƒÑ‚Ð°Ñ) -->
                                            <Label Text="{Binding OriginalPrice, StringFormat='{0:F0} ÑÐ¾Ð¼'}"
                                                   FontSize="14"
                                                   TextColor="#999"
                                                   TextDecorations="Strikethrough"
                                                   IsVisible="{Binding OriginalPrice, Converter={StaticResource IsNotNullConverter}}"/>
                                            
                                            <!-- ÐÐ¾Ð²Ð°Ñ Ñ†ÐµÐ½Ð° Ð¸ Ð¼Ð¾Ð½ÐµÑ‚Ñ‹ -->
                                            <HorizontalStackLayout Spacing="4">
                                            <Label Text="{Binding Price, StringFormat='{0:F0} ÑÐ¾Ð¼'}"
                                                   FontSize="18"
                                                   FontAttributes="Bold"
                                                   TextColor="Black"/>
                                                <Label Text="{Binding YessCoins, StringFormat='+ {0:F0} Yess!Coins'}"
                                                       FontSize="14"
                                                       TextColor="#DC2626"
                                                       IsVisible="{Binding YessCoins, Converter={StaticResource IsNotNullConverter}}"/>
                                            </HorizontalStackLayout>
                                        </VerticalStackLayout>

                                        <!-- ÐšÐ½Ð¾Ð¿ÐºÐ° Ð¿Ð¾ÐºÑƒÐ¿ÐºÐ¸ -->
                                        <Button Grid.Column="1"
                                                Text="Ð’ ÐºÐ¾Ñ€Ð·Ð¸Ð½Ñƒ"
                                                BackgroundColor="#FF9800"
                                                TextColor="White"
                                                FontSize="14"
                                                FontAttributes="Bold"
                                                CornerRadius="8"
                                                Padding="16,8"
                                                VerticalOptions="Center"
                                                Clicked="OnAddToCartClicked"
                                                CommandParameter="{Binding .}"/>
                                    </Grid>
                                </Grid>
                            </Frame>
                        </DataTemplate>
                    </CollectionView.ItemTemplate>
                </CollectionView>
            </VerticalStackLayout>
        </VerticalStackLayout>
    </ScrollView>
</ContentPage>