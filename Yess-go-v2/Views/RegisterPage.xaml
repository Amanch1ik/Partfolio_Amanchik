<?xml version="1.0" encoding="utf-8" ?>
<ContentPage
    x:Class="YessGoFront.Views.RegisterPage"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:converters="clr-namespace:YessGoFront.Converters"
    xmlns:components="clr-namespace:YessGoFront.Components"
    Title="Ð ÐµÐ³Ð¸ÑÑ‚Ñ€Ð°Ñ†Ð¸Ñ"
    BackgroundColor="#007A51"
    Shell.NavBarIsVisible="False">
    
    <ContentPage.Resources>
        <converters:InverseBoolConverter x:Key="InvertedBoolConverter"/>
    </ContentPage.Resources>

    <ScrollView>
        <Grid RowDefinitions="Auto,*,Auto" Padding="24" RowSpacing="16">
            <!-- Ð¤Ð¾Ð½ Ñ Ð³Ñ€Ð°Ð´Ð¸ÐµÐ½Ñ‚Ð¾Ð¼ -->
            <Grid.Background>
                <LinearGradientBrush StartPoint="0,0" EndPoint="0,1">
                    <GradientStop Color="#007A51" Offset="0.0"/>
                    <GradientStop Color="#00C97B" Offset="1.0"/>
                </LinearGradientBrush>
            </Grid.Background>

            <!-- ÐšÐ°Ñ€Ñ‚Ð¾Ñ‡ÐºÐ° -->
            <Frame Grid.Row="1" Padding="20" CornerRadius="24" HasShadow="True" BackgroundColor="White">
                <VerticalStackLayout Spacing="16">

                    <!-- Ð’ÐºÐ»Ð°Ð´ÐºÐ¸ (Ð’Ñ…Ð¾Ð´ / Ð ÐµÐ³Ð¸ÑÑ‚Ñ€Ð°Ñ†Ð¸Ñ) -->
                    <Grid ColumnDefinitions="Auto,Auto" ColumnSpacing="16" Margin="0,0,0,8">
                        <Label Text="Ð’Ñ…Ð¾Ð´" TextColor="#B0B0B0">
                            <Label.GestureRecognizers>
                                <TapGestureRecognizer Tapped="OpenLogin_Tapped"/>
                            </Label.GestureRecognizers>
                        </Label>
                        <Label Grid.Column="1" Text="Ð ÐµÐ³Ð¸ÑÑ‚Ñ€Ð°Ñ†Ð¸Ñ" FontAttributes="Bold" TextColor="#0B4A3B"/>
                    </Grid>

                    <!-- ÐŸÐ¾Ð»Ðµ Ð˜Ð¼Ñ -->
                    <Border BackgroundColor="#E0EFE9" Stroke="Transparent" StrokeShape="RoundRectangle 16" HeightRequest="52">
                        <Grid Padding="12,0">
                            <Entry x:Name="FirstNameEntry" 
                                   Placeholder="Ð˜Ð¼Ñ" 
                                   Keyboard="Default" 
                                   BackgroundColor="Transparent"
                                   Text="{Binding FirstName}" />
                        </Grid>
                    </Border>

                    <!-- ÐŸÐ¾Ð»Ðµ Ð¤Ð°Ð¼Ð¸Ð»Ð¸Ñ -->
                    <Border BackgroundColor="#E0EFE9" Stroke="Transparent" StrokeShape="RoundRectangle 16" HeightRequest="52">
                        <Grid Padding="12,0">
                            <Entry x:Name="LastNameEntry" 
                                   Placeholder="Ð¤Ð°Ð¼Ð¸Ð»Ð¸Ñ" 
                                   Keyboard="Default" 
                                   BackgroundColor="Transparent"
                                   Text="{Binding LastName}" />
                        </Grid>
                    </Border>

                    <!-- ÐŸÐ¾Ð»Ðµ Ð¢ÐµÐ»ÐµÑ„Ð¾Ð½ -->
                    <components:PhoneEntry x:Name="PhoneEntryControl"
                                           FullPhoneNumber="{Binding Phone, Mode=TwoWay}" />

                    <!-- ÐžÑˆÐ¸Ð±ÐºÐ° Ñ‚ÐµÐ»ÐµÑ„Ð¾Ð½Ð° -->
                    <Label Text="{Binding PhoneError}" 
                           IsVisible="{Binding HasPhoneError}"
                           TextColor="#D32F2F" 
                           FontSize="12"
                           Margin="0,-8,0,0"/>

                    <!-- Ð¡Ð¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ Ð¾Ð± ÑƒÑÐ¿ÐµÑˆÐ½Ð¾Ð¹ Ð¾Ñ‚Ð¿Ñ€Ð°Ð²ÐºÐµ ÐºÐ¾Ð´Ð° -->
                    <Label Text="{Binding SuccessMessage}" 
                           IsVisible="{Binding IsCodeSent}"
                           TextColor="#4CAF50" 
                           FontSize="12"
                           Margin="0,-8,0,0"/>

                    <!-- ÐžÑ‚Ð¾Ð±Ñ€Ð°Ð¶ÐµÐ½Ð¸Ðµ ÐºÐ¾Ð´Ð° Ð²ÐµÑ€Ð¸Ñ„Ð¸ÐºÐ°Ñ†Ð¸Ð¸ (ÐºÑ€ÑƒÐ¿Ð½Ñ‹Ð¼ ÑˆÑ€Ð¸Ñ„Ñ‚Ð¾Ð¼) -->
                    <Border BackgroundColor="#E8F5E9" 
                            Stroke="#4CAF50" 
                            StrokeThickness="2"
                            StrokeShape="RoundRectangle 16" 
                            Padding="20"
                            Margin="0,8,0,8"
                            IsVisible="{Binding IsCodeSent}">
                        <VerticalStackLayout Spacing="8">
                            <Label Text="ÐšÐ¾Ð´ Ð²ÐµÑ€Ð¸Ñ„Ð¸ÐºÐ°Ñ†Ð¸Ð¸:" 
                                   TextColor="#2E7D32" 
                                   FontSize="14"
                                   FontAttributes="Bold"/>
                            <Label Text="{Binding DisplayedVerificationCode}" 
                                   TextColor="#0B4A3B" 
                                   FontSize="32"
                                   FontAttributes="Bold"
                                   HorizontalOptions="Center"
                                   HorizontalTextAlignment="Center"/>
                            <Label Text="Ð’Ð²ÐµÐ´Ð¸Ñ‚Ðµ ÑÑ‚Ð¾Ñ‚ ÐºÐ¾Ð´ Ð² Ð¿Ð¾Ð»Ðµ Ð½Ð¸Ð¶Ðµ" 
                                   TextColor="#666666" 
                                   FontSize="12"
                                   HorizontalOptions="Center"/>
                        </VerticalStackLayout>
                    </Border>

                    <!-- ÐŸÐ¾Ð»Ðµ ÐšÐ¾Ð´ Ð¿Ð¾Ð´Ñ‚Ð²ÐµÑ€Ð¶Ð´ÐµÐ½Ð¸Ñ (Ð¿Ð¾ÐºÐ°Ð·Ñ‹Ð²Ð°ÐµÑ‚ÑÑ Ñ‚Ð¾Ð»ÑŒÐºÐ¾ Ð½Ð° Ð²Ñ‚Ð¾Ñ€Ð¾Ð¼ ÑˆÐ°Ð³Ðµ) -->
                    <Border BackgroundColor="#E0EFE9" 
                            Stroke="Transparent" 
                            StrokeShape="RoundRectangle 16" 
                            HeightRequest="52"
                            IsVisible="{Binding IsVerificationStep}">
                        <Grid Padding="12,0">
                            <Entry x:Name="VerificationCodeEntry" 
                                   Placeholder="Ð’Ð²ÐµÐ´Ð¸Ñ‚Ðµ ÐºÐ¾Ð´ Ð¸Ð· SMS" 
                                   Keyboard="Numeric" 
                                   BackgroundColor="Transparent"
                                   Text="{Binding VerificationCode}"
                                   MaxLength="6" />
                        </Grid>
                    </Border>

                    <!-- ÐŸÐ¾Ð»Ðµ ÐŸÐ°Ñ€Ð¾Ð»ÑŒ -->
                    <Border BackgroundColor="#E0EFE9" Stroke="Transparent" StrokeShape="RoundRectangle 16" HeightRequest="52">
                        <Grid Padding="12,0" ColumnDefinitions="*,Auto">
                            <Entry x:Name="PasswordEntry" 
                                   Placeholder="ÐŸÐ°Ñ€Ð¾Ð»ÑŒ" 
                                   IsPassword="True" 
                                   BackgroundColor="Transparent"
                                   Text="{Binding Password}" />
                            <Label Grid.Column="1" 
                                   Text="ðŸ‘" 
                                   FontSize="20" 
                                   VerticalOptions="Center" 
                                   HorizontalOptions="Center"
                                   Padding="8,0"
                                   TextColor="#666666">
                                <Label.GestureRecognizers>
                                    <TapGestureRecognizer Tapped="TogglePassword_Tapped"/>
                                </Label.GestureRecognizers>
                            </Label>
                        </Grid>
                    </Border>

                    <!-- ÐŸÐ¾Ð»Ðµ ÐŸÐ¾Ð´Ñ‚Ð²ÐµÑ€Ð¶Ð´ÐµÐ½Ð¸Ðµ Ð¿Ð°Ñ€Ð¾Ð»Ñ -->
                    <Border BackgroundColor="#E0EFE9" Stroke="Transparent" StrokeShape="RoundRectangle 16" HeightRequest="52">
                        <Grid Padding="12,0" ColumnDefinitions="*,Auto">
                            <Entry x:Name="ConfirmPasswordEntry" 
                                   Placeholder="ÐŸÐ¾Ð´Ñ‚Ð²ÐµÑ€Ð´Ð¸Ñ‚Ðµ Ð¿Ð°Ñ€Ð¾Ð»ÑŒ" 
                                   IsPassword="True" 
                                   BackgroundColor="Transparent"
                                   Text="{Binding ConfirmPassword}" />
                            <Label Grid.Column="1" 
                                   Text="ðŸ‘" 
                                   FontSize="20" 
                                   VerticalOptions="Center" 
                                   HorizontalOptions="Center"
                                   Padding="8,0"
                                   TextColor="#666666">
                                <Label.GestureRecognizers>
                                    <TapGestureRecognizer Tapped="ToggleConfirmPassword_Tapped"/>
                                </Label.GestureRecognizers>
                            </Label>
                        </Grid>
                    </Border>

                    <!-- Ð¢ÐµÐºÑÑ‚ Ñ ÑÑÑ‹Ð»ÐºÐ¾Ð¹ Ð½Ð° Ð¿Ð¾Ð»Ð¸Ñ‚Ð¸ÐºÑƒ ÐºÐ¾Ð½Ñ„Ð¸Ð´ÐµÐ½Ñ†Ð¸Ð°Ð»ÑŒÐ½Ð¾ÑÑ‚Ð¸ -->
                    <Label x:Name="PolicyLinkLabel" 
                           FontSize="13" 
                           TextColor="#666666"
                           Margin="0,0,0,8">
                        <Label.FormattedText>
                            <FormattedString>
                                <Span Text="Ð¯ ÑÐ¾Ð³Ð»Ð°ÑÐµÐ½(Ð°) Ñ " />
                                <Span x:Name="PolicyLinkSpan" 
                                      Text="Ð¿Ð¾Ð»Ð¸Ñ‚Ð¸ÐºÐ¾Ð¹ ÐºÐ¾Ð½Ñ„Ð¸Ð´ÐµÐ½Ñ†Ð¸Ð°Ð»ÑŒÐ½Ð¾ÑÑ‚Ð¸" 
                                      TextColor="#007A51"
                                      TextDecorations="Underline"
                                      FontAttributes="Bold">
                                    <Span.GestureRecognizers>
                                        <TapGestureRecognizer Tapped="OnPolicyLinkTapped"/>
                                    </Span.GestureRecognizers>
                                </Span>
                            </FormattedString>
                        </Label.FormattedText>
                    </Label>

                    <HorizontalStackLayout Spacing="8">
                        <CheckBox x:Name="acknowledged" Color="#007A51" IsChecked="{Binding IsPolicyAcknowledged}"/>
                        <Label Text="ÐžÐ·Ð½Ð°ÐºÐ¾Ð¼Ð»ÐµÐ½(Ð°)" VerticalOptions="Center"/>
                    </HorizontalStackLayout>

                    <!-- Ð¡Ð¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ Ð¾Ð± Ð¾ÑˆÐ¸Ð±ÐºÐµ -->
                    <Label Text="{Binding ErrorMessage}" 
                           IsVisible="{Binding HasError}"
                           TextColor="#D32F2F" 
                           FontSize="12"
                           Margin="0,-8,0,0"/>

                    <!-- ÐšÐ½Ð¾Ð¿ÐºÐ° Ñ€ÐµÐ³Ð¸ÑÑ‚Ñ€Ð°Ñ†Ð¸Ð¸ -->
                    <Grid HeightRequest="52">
                        <Button Text="Ð—Ð°Ñ€ÐµÐ³Ð¸ÑÑ‚Ñ€Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒÑÑ"
                                HeightRequest="52"
                                CornerRadius="16"
                                BackgroundColor="#0B4A3B"
                                TextColor="White"
                                Command="{Binding RegisterCommand}"
                                IsEnabled="{Binding IsBusy, Converter={StaticResource InvertedBoolConverter}}">
                            <Button.Triggers>
                                <DataTrigger TargetType="Button" Binding="{Binding IsBusy}" Value="True">
                                    <Setter Property="Text" Value="ÐžÑ‚Ð¿Ñ€Ð°Ð²ÐºÐ°..." />
                                    <Setter Property="Opacity" Value="0.7" />
                                </DataTrigger>
                                <DataTrigger TargetType="Button" Binding="{Binding IsVerificationStep}" Value="True">
                                    <Setter Property="Text" Value="ÐŸÐ¾Ð´Ñ‚Ð²ÐµÑ€Ð´Ð¸Ñ‚ÑŒ Ð¸ Ð·Ð°Ñ€ÐµÐ³Ð¸ÑÑ‚Ñ€Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒÑÑ" />
                                </DataTrigger>
                                <DataTrigger TargetType="Button" Binding="{Binding IsRegistrationSuccessful}" Value="True">
                                    <Setter Property="IsEnabled" Value="False" />
                                    <Setter Property="Text" Value="Ð ÐµÐ³Ð¸ÑÑ‚Ñ€Ð°Ñ†Ð¸Ñ Ð·Ð°Ð²ÐµÑ€ÑˆÐµÐ½Ð°" />
                                    <Setter Property="Opacity" Value="0.6" />
                                </DataTrigger>
                            </Button.Triggers>
                        </Button>
                        <ActivityIndicator IsRunning="{Binding IsBusy}" 
                                          IsVisible="{Binding IsBusy}"
                                          Color="White"
                                          VerticalOptions="Center"
                                          HorizontalOptions="Center" />
                    </Grid>

                    <Label Text="Ð£ Ð²Ð°Ñ ÐµÑÑ‚ÑŒ Ð°ÐºÐºÐ°ÑƒÐ½Ñ‚"
				        TextColor="#0B4A3B"
				        FontSize="16"
				        TextDecorations="Underline"
				        HorizontalOptions="Center">
                        <Label.GestureRecognizers>
                            <TapGestureRecognizer Tapped="OnLoginsPage" />
                        </Label.GestureRecognizers>
                    </Label>

                    <BoxView HeightRequest="1" Color="#E0E0E0" Margin="0,8"/>

                    <!-- Ð’Ñ…Ð¾Ð´ Ñ‡ÐµÑ€ÐµÐ· Google -->
                    <Button Text="Ð’Ð¾Ð¹Ñ‚Ð¸ Ñ Ð¿Ð¾Ð¼Ð¾Ñ‰ÑŒÑŽ Google"
                            HeightRequest="48"
                            CornerRadius="12"
                            BackgroundColor="White"
                            TextColor="Black"/>
                </VerticalStackLayout>
            </Frame>
        </Grid>
    </ScrollView>
</ContentPage>
